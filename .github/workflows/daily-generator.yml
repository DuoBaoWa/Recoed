name: Daily File Generator

on:
  schedule:
    - cron: '0 0 * * *'  # 每天 UTC 时间 00:00 运行（北京时间 08:00）
  workflow_dispatch:     # 允许手动触发

jobs:
  generate-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Generate new file
        run: |
          # 设置时间变量
          DATE=$(date +"%Y-%m-%d")
          TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S %Z")
          
          # 创建目标目录
          mkdir -p generated_files
          
          # 处理模板
          sed "s/{{DATE}}/$DATE/g; s/{{TIMESTAMP}}/$TIMESTAMP/g" templates/template.md > "generated_files/report-$DATE.md"

      - name: Commit changes
        uses: EndBug/add-and-commit@v9
        with:
          add: 'generated_files/*'
          commit_message: "Auto-generated report for ${{ steps.vars.outputs.date }}"
          committer_name: GitHub Actions
          committer_email: actions@github.com